@page "/account/logout"
@layout Layout.NullLayout
@attribute [AllowAnonymous]

@inject IAuthService Auth
@inject IHostCapabilities Caps
@inject HostedAuthStateProvider AuthProvider
@inject NavigationManager Nav

<PageTitle>Signing out...</PageTitle>

@if (Caps.RequiresFullReloadAfterAuth)
{
    <!-- WEB: post to the minimal-api endpoint that signs out & redirects -->
    <form method="post" action="/_internal/logout"><noscript><button type="submit">Sign out</button></noscript></form>
    <script>window.onload = () => document.forms[0]?.submit();</script>
}

@code {

    protected override async Task OnInitializedAsync()
    {
        if (Caps.RequiresFullReloadAfterAuth) return;

        await Auth.SignOutAsync();
        AuthProvider.Notify();
        Nav.NavigateToAfterAuth("/account/login", Caps.RequiresFullReloadAfterAuth);
    }

}
